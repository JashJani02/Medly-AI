<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medly AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="chat-container">
    <h2>ü©∫ Medly AI</h2>

    <!-- Model Toggle -->
    <div class="model-select">
      <label for="model">üîÄ Model:</label>
      <select id="model">
        <option value="medllama2" selected>MedLLaMA 2</option>
        <option value="llama3.2-vision">Llama 3.2 Vision</option>
      </select>


      <label for="lang">üåè Languages</label>
      <select id="lang">
        <option value="en" selected>English</option>
        <option value="hi">Hindi</option>
        <option value="gu">Gujarati</option>
        <option value="tmail">Tamil</option>
        <option value="telegu">Telegu</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="ru">Russian</option>
        </select>
        
    </div>

    <!-- Chat Box -->
    <div id="chat-box"></div>

    <!-- Input Row -->
    <div class="input-container">
      <input type="file" id="file" style="display:none;" onchange="uploadFile()" />
      <label for="file" class="attach-btn">üìÅ</label>

      <input id="user-input" placeholder="Ask your medical question...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    async function sendMessage() {
      const message = document.getElementById("user-input").value.trim();
      if (!message) return;

      // Get selected model
      const model = document.getElementById("model").value;
      const lang = document.getElementById("lang").value;

      const res = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ message, model, lang })
      });
      const data = await res.json();

      const box = document.getElementById("chat-box");
      box.innerHTML += `<p><b>You:</b> ${message}</p>`;
      box.innerHTML += `<p><b>${model}:</b> ${data.reply}</p>`;
      if (data.audio) {
      box.innerHTML += `
        <audio controls>
          <source src="${data.audio}" type="audio/mpeg">
          Your browser does not support audio playback.
        </audio>
      `;
    } 

      document.getElementById("user-input").value = "";
      box.scrollTop = box.scrollHeight;
    }

    async function uploadFile() {
      const fileInput = document.getElementById("file");
      if (fileInput.files.length === 0) {
        alert("Please select a file first!");
        return;
      }
      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch("/upload", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      alert(data.success ? "üìÇ " + data.message : "Error: " + data.error);
    }
  </script>
</body>
</html>
